/* Write your PL/SQL query statement below */

WITH RECENT_ORDER AS(
    SELECT 
    CUSTOMER_ID,
    ORDER_ID,
    ORDER_DATE,
    DENSE_RANK() OVER(PARTITION BY CUSTOMER_ID ORDER BY ORDER_DATE DESC) AS RANK
FROM
    ORDERS)
    

SELECT 
    C.NAME AS CUSTOMER_NAME,
    R.CUSTOMER_ID,
    R.ORDER_ID,
    TO_CHAR(R.ORDER_DATE,'YYYY-MM-DD') AS ORDER_DATE
FROM 
    RECENT_ORDER R
JOIN 
    CUSTOMERS C
ON
    C.CUSTOMER_ID = R.CUSTOMER_ID
WHERE RANK <=3
ORDER BY
    C.NAME ASC,
    R.CUSTOMER_ID ASC,
    R.ORDER_DATE DESC;
